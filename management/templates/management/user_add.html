{% extends "management/admin_base.html" %}
{% load staticfiles %}

{% block admin_work %}
    <script>
    $(document).ready(function(){
        $("div#for_village_clinic").hide()
        $("div#for_town_clinic").hide()
        $("div#for_town_clinic_department").hide();
        $("select#user_type").change(function(){
            if ($(this).find("option:selected").text() == "全局管理员") {
                $("div#for_village_clinic").hide();
                $("div#for_town_clinic").hide();
                $("div#for_town_clinic_department").hide()
            }
            else if ($(this).find("option:selected").text() == "村医") {
                $("div#for_village_clinic").show();
                $("div#for_town_clinic").hide();
                $("div#for_town_clinic_department").hide()
            }
            else if ($(this).find("option:selected").text() == "卫生院医生") {
                $("div#for_village_clinic").hide();
                $("div#for_town_clinic").show();
                $("div#for_town_clinic_department").show()
            }
            else if ($(this).find("option:selected").text() == "卫生院管理员"){
                $("div#for_village_clinic").hide();
                $("div#for_town_clinic").show();
                $("div#for_town_clinic_department").hide()
            }
        });
    })
    </script>

    <div class="row" align="center" >
        <form class="form-inline" role="form"  method="POST" action="{% url 'management:user_new' %}">
        {% if err_msg %}
        <h5 class="page-header" align="left">{{ err_msg }}</h5>
        {% endif %}
            {% csrf_token %}
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="type">用户类别:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <select id="user_type" class="form-control" name="role_id">
                            <option value="0">请选择</option>
                            {% for role in roles %}
                                {% if user.is_superuser %}
                                <option value="{{ role.id }}">{{ role.name }}</option>
                                {% elif not user.is_superuser and user.is_staff > role.groupprofile.is_staff %}
                                <option value="{{ role.id }}">{{ role.name }}</option>
                                {% elif user.userprofile.role.name == "全局管理员" and role.name == "卫生院管理员" %}
                                <option value="{{ role.id }}">{{ role.name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="name">用户名称:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <input type="text" class="form-control" name="name" />&nbsp;&nbsp;<span style="color: red;">{{ name_err_msg }}</span>
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="password">登陆密码:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <input type="password" class="form-control" name="password"/>
                    </div>
                </div>
            </div><!-- for row -->
            <div id="for_village_clinic">
                {% include 'management/two_level_clinic_select.html' %}
            </div>
            <div id="for_town_clinic">
                {% include 'management/town_clinic_select.html' %}
            </div><!-- for_town_clinic -->
            <div id="for_town_clinic_department">
                <div class="row" style="padding-top: 30px">
                    <div class="col-md-6" align="right">
                        <div class="form-group">
                            <label for="department">所在科室:</label>
                        </div>
                    </div>
                    <div class="col-md-6" align="left">
                        <div class="form-group">
                            <input type="text" name="department" class="form-control"/>
                        </div>
                    </div>
                </div><!-- for row -->
                <div class="row" style="padding-top: 30px">
                    <div class="col-md-6" align="right">
                        <div class="form-group">
                            <label for="position">职务:</label>
                        </div>
                    </div>
                    <div class="col-md-6" align="left">
                        <div class="form-group">
                            <input type="text" name="position" class="form-control"/>
                        </div>
                    </div>
                </div><!-- for row -->
            </div>
            <div class="row" style="padding-top: 30px" align="center">
                <div class="col-md-6 col-md-offset-4">
                    <button type="submit" class="btn btn-default">提交</button>&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if user.userprofile.role.name == "卫生院管理员" %}
                        <a href="{% url 'management:town_staff_user_list' %}" class="btn btn-default">返回</a>
                    {% else %}
                        <a href="{% url 'management:user_list' %}" class="btn btn-default">返回</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
{% endblock %}
