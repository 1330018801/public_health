{% extends "management/admin_base.html" %}
{% load staticfiles %}

{% block admin_work %}
    <div class="row" align="center" >
        <form class="form-inline" role="form" method="POST" action="{% url 'management:village_clinic_new' %}">
            {% csrf_token %}
            {% if err_msg %}
            <h5 class="page-header" align="left">{{ err_msg }}</h5>
            {% endif %}
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="name">村卫生室名称:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <input type="text" class="form-control" name="name" />
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="name">所属乡镇卫生院:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        {% if user.userprofile.role.name != "卫生院管理员" %}
                            <select id="town_clinic" name="town_clinic" class="form-control">
                                <option value="0">请选择</option>
                            {% for town_clinic in town_clinics %}
                                <option value="{{ town_clinic.id }}">{{ town_clinic.name }}</option>
                            {% endfor %}
                            </select>
                        {% else %}
                            {{ town_clinic.name }}<input type="text" style="display: none;" name="town_clinic" value="{{ town_clinic.id }}">
                        {% endif %}
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="town">所在乡镇:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        {% if user.userprofile.role.name != "卫生院管理员" %}
                            <select id="town" class="form-control" name="town">
                                <option value="0">请选择</option>
                            {% for town in towns %}
                                <option value="{{ town.id }}">{{ town.name }}</option>
                            {% endfor %}
                            </select>
                        {% else %}
                            {{ town.name }}<input type="text" style="display: none;" value="{{ town.id }}" name="town">
                        {% endif %}
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="village">所在村庄:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <select id="village" class="form-control" name="village">
                            <option value="0">请选择</option>
                        {% for village in villages %}
                            <option value="{{ village.id }}">{{ village.name }}</option>
                        {% endfor %}
                        </select>
                    </div>
                </div>
            </div><!-- for row -->
            <script>
                $(document).ready(function() {
                    $("select#town").change(function() {
                        if ($(this).val() == '0'){
                            $("select#village").html("<option>请选择</option>");
                            $("select#village").attr('disabled', true);
                        }
                        else {
                            var url = "/management/town/" + $(this).val() + "/villages/";
                            $.getJSON(url, function(villages) {
                                var options = '<option value="0">请选择</option>';
                                for (var i = 0; i < villages.length; i++) {
                                    options += '<option value="' + villages[i].pk + '">' + villages[i].fields['name'] + '</option>';
                                }
                                $("select#village").html(options);
                                $("select#village option:first").attr('selected', 'selected');
                                $("select#village").attr('disabled', false);
                            });
                        }
                    });
                })
            </script>
            <div class="row" style="padding-top: 30px">
                <div class="col-md-6" align="right">
                    <div class="form-group">
                        <label for="address">地址:</label>
                    </div>
                </div>
                <div class="col-md-6" align="left">
                    <div class="form-group">
                        <input class="form-control" type="text" name="address">
                    </div>
                </div>
            </div><!-- for row -->
            <div class="row" style="padding-top: 30px" align="center">
                <div class="col-md-6 col-md-offset-4">
                    <button type="submit" class="btn btn-default">提交</button>&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if user.userprofile.role.name == "卫生院管理员" %}
                        <a href="{% url 'management:town_staff_village_clinic_list' %}" class="btn btn-default">返回</a>
                    {% else %}
                        <a href="{% url 'management:village_clinic_list' %}" class="btn btn-default">返回</a>
                    {% endif %}
                </div>
            </div>
        </form>
    </div>
{% endblock %}